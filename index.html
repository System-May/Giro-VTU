<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle Unitário - Giro Grão VTU</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ea580c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Controle VTU">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- XLSX Library -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: system-ui, -apple-system, sans-serif;
    }
    
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
    }
    
    .toast {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 16px 20px;
      margin-top: 8px;
      min-width: 300px;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .toast.success {
      border-left: 4px solid #10b981;
    }
    
    .toast.error {
      border-left: 4px solid #ef4444;
    }
    
    .toast-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .toast-description {
      font-size: 14px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="toast-container" class="toast-container"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Toast System
    const showToast = (type, title, description = '') => {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <div class="toast-title">${title}</div>
        ${description ? `<div class="toast-description">${description}</div>` : ''}
      `;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => container.removeChild(toast), 300);
      }, 3000);
    };

    // Lucide Icons Components
    const Train = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect width="16" height="16" x="4" y="3" rx="2"/>
        <path d="M4 11h16"/>
        <path d="M12 3v8"/>
        <path d="m8 19-2 3"/>
        <path d="m18 22-2-3"/>
        <path d="M8 15h0"/>
        <path d="M16 15h0"/>
      </svg>
    );

    const CheckCircle = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
        <polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
    );

    const Download = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" x2="12" y1="15" y2="3"/>
      </svg>
    );

    const Trash2 = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 6h18"/>
        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
        <line x1="10" x2="10" y1="11" y2="17"/>
        <line x1="14" x2="14" y1="11" y2="17"/>
      </svg>
    );

    const FileSpreadsheet = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/>
        <path d="M14 2v4a2 2 0 0 0 2 2h4"/>
        <path d="M8 13h2"/>
        <path d="M14 13h2"/>
        <path d="M8 17h2"/>
        <path d="M14 17h2"/>
      </svg>
    );

    // Form Component
    function ControlePainelForm({ onSubmit }) {
      const motivosLista = [
        "ALTERAÇÃO PROGRAMAÇÃO PCO",
        "ATRASO DOCUMENTAÇÃO FERTI",
        "AVARIA DE LOCOMOTIVA / VAGÃO",
        "CARREGAMENTO PORTO / FERTI",
        "CONDIÇÕES CLIMÁTICAS",
        "DEFEITO SINALIZAÇÃO",
        "DESCARGA MOEGA / PORTO",
        "FALTA / ATRASO EQUIPAGEM",
        "FALTA DE LOCOMOTIVA",
        "FALTA ENERGIA",
        "MANOBRA DE PATIO",
        "PATIO CONGESTIONADO",
        "PRIORIDADE CIRCULAÇÃO OUTROS FLUXOS",
        "REFLEXO OUTROS FLUXOS (AMT / CNT)",
        "VP - MANUTENÇÃO",
      ];

      const [formData, setFormData] = useState({
        prefixoChegada: "",
        qtdVZ: "",
        produto: "",
        entradaVTU: "",
        inicioDescarga: "",
        terminoDescarga: "",
        saidaVTU: "",
        metaAntes: "04:57",
        realAntes: "",
        motivoAntes: "",
        observacaoAntes: "",
        metaDurante: "05:34",
        realDurante: "",
        motivoDurante: "",
        observacaoDurante: "",
        metaApos: "15:39",
        realApos: "",
        motivoApos: "",
        observacaoApos: "",
      });

      const getCorReal = (meta, real) => {
        if (!meta || !real) return "bg-gray-100";
        
        const [metaH, metaM] = meta.split(":").map(Number);
        const [realH, realM] = real.split(":").map(Number);
        
        const metaMinutos = metaH * 60 + metaM;
        const realMinutos = realH * 60 + realM;
        
        return realMinutos <= metaMinutos ? "bg-green-500 text-white" : "bg-red-500 text-white";
      };

      useEffect(() => {
        if (formData.entradaVTU && formData.inicioDescarga) {
          const entrada = new Date(formData.entradaVTU);
          const inicio = new Date(formData.inicioDescarga);
          const diffMs = inicio.getTime() - entrada.getTime();
          const diffMinutos = Math.floor(diffMs / (1000 * 60));
          
          const horas = Math.floor(diffMinutos / 60);
          const minutos = diffMinutos % 60;
          
          setFormData(prev => ({
            ...prev,
            realAntes: `${String(horas).padStart(2, "0")}:${String(Math.abs(minutos)).padStart(2, "0")}`
          }));
        }
      }, [formData.entradaVTU, formData.inicioDescarga]);

      useEffect(() => {
        if (formData.inicioDescarga && formData.terminoDescarga) {
          const inicio = new Date(formData.inicioDescarga);
          const final = new Date(formData.terminoDescarga);
          const diffMs = final.getTime() - inicio.getTime();
          const diffMinutos = Math.floor(diffMs / (1000 * 60));
          
          const horas = Math.floor(diffMinutos / 60);
          const minutos = diffMinutos % 60;
          
          setFormData(prev => ({
            ...prev,
            realDurante: `${String(horas).padStart(2, "0")}:${String(Math.abs(minutos)).padStart(2, "0")}`
          }));
        }
      }, [formData.inicioDescarga, formData.terminoDescarga]);

      useEffect(() => {
        if (formData.terminoDescarga && formData.saidaVTU) {
          const final = new Date(formData.terminoDescarga);
          const saida = new Date(formData.saidaVTU);
          const diffMs = saida.getTime() - final.getTime();
          const diffMinutos = Math.floor(diffMs / (1000 * 60));
          
          const horas = Math.floor(diffMinutos / 60);
          const minutos = diffMinutos % 60;
          
          setFormData(prev => ({
            ...prev,
            realApos: `${String(horas).padStart(2, "0")}:${String(Math.abs(minutos)).padStart(2, "0")}`
          }));
        }
      }, [formData.terminoDescarga, formData.saidaVTU]);

      const handleChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
      };

      const handleSubmit = (e) => {
        e.preventDefault();

        const camposObrigatorios = [
          "prefixoChegada",
          "produto",
          "entradaVTU",
          "inicioDescarga",
          "terminoDescarga",
          "saidaVTU",
        ];

        const camposVazios = camposObrigatorios.filter(
          campo => !formData[campo].trim()
        );

        if (camposVazios.length > 0) {
          showToast("error", "Campos obrigatórios não preenchidos!", "Preencha todos os campos principais antes de confirmar.");
          return;
        }

        onSubmit(formData);

        setFormData({
          prefixoChegada: "",
          qtdVZ: "",
          produto: "",
          entradaVTU: "",
          inicioDescarga: "",
          terminoDescarga: "",
          saidaVTU: "",
          metaAntes: "04:57",
          realAntes: "",
          motivoAntes: "",
          observacaoAntes: "",
          metaDurante: "05:34",
          realDurante: "",
          motivoDurante: "",
          observacaoDurante: "",
          metaApos: "15:39",
          realApos: "",
          motivoApos: "",
          observacaoApos: "",
        });

        showToast("success", "Registro salvo com sucesso!", `${formData.produto} registrado.`);
      };

      return (
        <form onSubmit={handleSubmit}>
          <div className="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg shadow-2xl overflow-hidden">
            {/* Header */}
            <div className="bg-orange-600 px-6 py-3 flex items-center gap-3 border-b-4 border-orange-700">
              <div className="bg-white p-2 rounded-md shadow-md">
                <Train />
              </div>
              <div className="flex-1 text-center">
                <h1 className="text-xl font-bold text-white">Controle Unitário - Antes - Durante - Depois</h1>
                <p className="text-xs text-orange-100">Sistema de controle Unitário – Giro Grão VTU</p>
              </div>
            </div>

            <div className="p-6 space-y-6">
              {/* Campos principais */}
              <div className="grid grid-cols-7 gap-4">
                <div>
                  <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                    Trem
                  </label>
                  <input
                    type="text"
                    value={formData.prefixoChegada}
                    onChange={(e) => handleChange("prefixoChegada", e.target.value)}
                    className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold text-sm focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                  />
                </div>

                <div>
                  <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                    QTD VZ *
                  </label>
                  <input
                    type="text"
                    value={formData.qtdVZ}
                    onChange={(e) => handleChange("qtdVZ", e.target.value)}
                    className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold text-sm focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                  />
                </div>

                <div>
                  <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                    Produto
                  </label>
                  <input
                    type="text"
                    value={formData.produto}
                    onChange={(e) => handleChange("produto", e.target.value)}
                    className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold text-sm focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                  />
                </div>

                <div>
                  <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                    Entrada VTU
                  </label>
                  <input
                    type="datetime-local"
                    value={formData.entradaVTU}
                    onChange={(e) => handleChange("entradaVTU", e.target.value)}
                    style={{fontSize: '12px'}}
                    className="w-full px-1 py-2.5 rounded bg-white border-2 border-white font-bold focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                  />
                </div>

                <div>
                  <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                    Início MG
                  </label>
                  <input
                    type="datetime-local"
                    value={formData.inicioDescarga}
                    onChange={(e) => handleChange("inicioDescarga", e.target.value)}
                    style={{fontSize: '12px'}}
                    className="w-full px-1 py-2.5 rounded bg-white border-2 border-white font-bold focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                  />
                </div>

                <div>
                  <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                    Final MG
                  </label>
                  <input
                    type="datetime-local"
                    value={formData.terminoDescarga}
                    onChange={(e) => handleChange("terminoDescarga", e.target.value)}
                    style={{fontSize: '12px'}}
                    className="w-full px-1 py-2.5 rounded bg-white border-2 border-white font-bold focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                  />
                </div>

                <div>
                  <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                    Saída da VTU
                  </label>
                  <input
                    type="datetime-local"
                    value={formData.saidaVTU}
                    onChange={(e) => handleChange("saidaVTU", e.target.value)}
                    style={{fontSize: '12px'}}
                    className="w-full px-1 py-2.5 rounded bg-white border-2 border-white font-bold focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                  />
                </div>
              </div>

              {/* META ANTES */}
              <div className="bg-orange-700/30 rounded-lg p-4">
                <h3 className="text-white font-bold text-xs mb-3 bg-red-600 inline-block px-3 py-1 rounded">
                  ANTES
                </h3>
                <div className="grid gap-3" style={{gridTemplateColumns: '120px 120px 200px 1fr'}}>
                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      META
                    </label>
                    <input
                      type="time"
                      value={formData.metaAntes}
                      readOnly
                      className="w-full px-2 py-2.5 rounded bg-yellow-400 border-2 border-white font-bold text-sm text-center text-black focus:outline-none cursor-not-allowed h-10"
                    />
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      REAL
                    </label>
                    <input
                      type="text"
                      value={formData.realAntes}
                      readOnly
                      className={`w-full px-2 py-2.5 rounded ${getCorReal(formData.metaAntes, formData.realAntes)} border-2 border-white font-bold text-sm text-center focus:outline-none cursor-not-allowed h-10`}
                    />
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      MOTIVO
                    </label>
                    <select
                      value={formData.motivoAntes}
                      onChange={(e) => handleChange("motivoAntes", e.target.value)}
                      style={{fontSize: '10px'}}
                      className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                    >
                      <option value="">Selecione...</option>
                      {motivosLista.map((motivo) => (
                        <option key={motivo} value={motivo}>
                          {motivo}
                        </option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      OBSERVAÇÃO
                    </label>
                    <input
                      type="text"
                      value={formData.observacaoAntes}
                      onChange={(e) => handleChange("observacaoAntes", e.target.value)}
                      className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold text-sm focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                    />
                  </div>
                </div>
              </div>

              {/* META DURANTE */}
              <div className="bg-orange-700/30 rounded-lg p-4">
                <h3 className="text-white font-bold text-xs mb-3 bg-red-600 inline-block px-3 py-1 rounded">
                  DURANTE
                </h3>
                <div className="grid gap-3" style={{gridTemplateColumns: '120px 120px 200px 1fr'}}>
                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      META
                    </label>
                    <input
                      type="time"
                      value={formData.metaDurante}
                      readOnly
                      className="w-full px-2 py-2.5 rounded bg-yellow-400 border-2 border-white font-bold text-sm text-center text-black focus:outline-none cursor-not-allowed h-10"
                    />
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      REAL
                    </label>
                    <input
                      type="text"
                      value={formData.realDurante}
                      readOnly
                      className={`w-full px-2 py-2.5 rounded ${getCorReal(formData.metaDurante, formData.realDurante)} border-2 border-white font-bold text-sm text-center focus:outline-none cursor-not-allowed h-10`}
                    />
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      MOTIVO
                    </label>
                    <select
                      value={formData.motivoDurante}
                      onChange={(e) => handleChange("motivoDurante", e.target.value)}
                      style={{fontSize: '10px'}}
                      className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                    >
                      <option value="">Selecione...</option>
                      {motivosLista.map((motivo) => (
                        <option key={motivo} value={motivo}>
                          {motivo}
                        </option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      OBSERVAÇÃO
                    </label>
                    <input
                      type="text"
                      value={formData.observacaoDurante}
                      onChange={(e) => handleChange("observacaoDurante", e.target.value)}
                      className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold text-sm focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                    />
                  </div>
                </div>
              </div>

              {/* META DEPOIS */}
              <div className="bg-orange-700/30 rounded-lg p-4">
                <h3 className="text-white font-bold text-xs mb-3 bg-red-600 inline-block px-3 py-1 rounded">
                  DEPOIS
                </h3>
                <div className="grid gap-3" style={{gridTemplateColumns: '120px 120px 200px 1fr'}}>
                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      META
                    </label>
                    <input
                      type="time"
                      value={formData.metaApos}
                      readOnly
                      className="w-full px-2 py-2.5 rounded bg-yellow-400 border-2 border-white font-bold text-sm text-center text-black focus:outline-none cursor-not-allowed h-10"
                    />
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      REAL
                    </label>
                    <input
                      type="text"
                      value={formData.realApos}
                      readOnly
                      className={`w-full px-2 py-2.5 rounded ${getCorReal(formData.metaApos, formData.realApos)} border-2 border-white font-bold text-sm text-center focus:outline-none cursor-not-allowed h-10`}
                    />
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      MOTIVO
                    </label>
                    <select
                      value={formData.motivoApos}
                      onChange={(e) => handleChange("motivoApos", e.target.value)}
                      style={{fontSize: '10px'}}
                      className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                    >
                      <option value="">Selecione...</option>
                      {motivosLista.map((motivo) => (
                        <option key={motivo} value={motivo}>
                          {motivo}
                        </option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="text-white text-xs font-bold block mb-1 bg-orange-700 px-2 py-1 rounded">
                      OBSERVAÇÃO
                    </label>
                    <input
                      type="text"
                      value={formData.observacaoApos}
                      onChange={(e) => handleChange("observacaoApos", e.target.value)}
                      className="w-full px-2 py-2.5 rounded bg-white border-2 border-white font-bold text-sm focus:outline-none focus:ring-2 focus:ring-orange-300 h-10"
                    />
                  </div>
                </div>
              </div>

              {/* Botão Confirmar */}
              <div className="flex justify-center pt-4">
                <button
                  type="submit"
                  className="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-bold text-lg flex items-center gap-2 shadow-lg transition-colors"
                >
                  <CheckCircle />
                  CONFIRMAR REGISTRO
                </button>
              </div>

              {/* Logo SYSTEMAY */}
              <div className="flex justify-end">
                <div className="bg-white rounded-lg px-8 py-4 shadow-lg border-2 border-orange-200">
                  <div className="flex items-center gap-3">
                    <svg width="40" height="40" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                      <defs>
                        <linearGradient id="rocketGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" style={{stopColor:"#ea580c", stopOpacity:1}} />
                          <stop offset="100%" style={{stopColor:"#fb923c", stopOpacity:1}} />
                        </linearGradient>
                      </defs>
                      <path d="M50 10 L60 40 L70 35 L55 65 L60 50 L50 55 L40 50 L45 65 L30 35 L40 40 Z" 
                            fill="url(#rocketGradient)" stroke="#ea580c" strokeWidth="2"/>
                      <ellipse cx="50" cy="75" rx="20" ry="8" fill="#ea580c" opacity="0.3"/>
                    </svg>
                    <div>
                      <div className="text-2xl font-bold" style={{color:"#ea580c", letterSpacing:"1px"}}>
                        SYSTEMAY
                      </div>
                      <div className="text-xs text-gray-600">
                        Sistemas inteligentes para gestão
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      );
    }

    // Table Component
    function RegistrosTable({ registros, onDelete }) {
      const exportToExcel = () => {
        if (registros.length === 0) {
          showToast("error", "Nenhum registro para exportar", "Adicione registros antes de exportar para Excel.");
          return;
        }

        const dados = registros.map((registro) => ({
          "Prefixo Chegada": registro.prefixoChegada,
          "QTD VZ": registro.qtdVZ,
          "Produto": registro.produto,
          "Entrada VTU": registro.entradaVTU,
          "Início Descarga": registro.inicioDescarga,
          "Término Descarga": registro.terminoDescarga,
          "Saída VTU": registro.saidaVTU,
          "Meta Antes": registro.metaAntes,
          "Real Antes": registro.realAntes,
          "Motivo Antes": registro.motivoAntes,
          "Observação Antes": registro.observacaoAntes,
          "Meta Durante": registro.metaDurante,
          "Real Durante": registro.realDurante,
          "Motivo Durante": registro.motivoDurante,
          "Observação Durante": registro.observacaoDurante,
          "Meta Após": registro.metaApos,
          "Real Após": registro.realApos,
          "Motivo Após": registro.motivoApos,
          "Observação Após": registro.observacaoApos,
        }));

        const ws = XLSX.utils.json_to_sheet(dados);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Controle Unitário");

        const colWidths = Array(19).fill({ wch: 15 });
        ws["!cols"] = colWidths;

        const fileName = `controle_unitario_${new Date().toISOString().split("T")[0]}.xlsx`;
        XLSX.writeFile(wb, fileName);

        showToast("success", "Planilha exportada com sucesso!", `Arquivo ${fileName} foi baixado.`);
      };

      const handleDelete = (id) => {
        if (confirm("Tem certeza que deseja excluir este registro? Esta ação não pode ser desfeita.")) {
          onDelete(id);
          showToast("success", "Registro excluído com sucesso!");
        }
      };

      if (registros.length === 0) {
        return (
          <div className="text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200">
            <FileSpreadsheet />
            <p className="text-gray-500 mb-2 mt-4">Nenhum registro encontrado</p>
            <p className="text-sm text-gray-400">Use o painel acima para adicionar registros</p>
          </div>
        );
      }

      return (
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <h3 className="text-lg font-semibold">Histórico de Registros</h3>
            <button 
              onClick={exportToExcel} 
              className="gap-2 bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-white font-semibold flex items-center"
            >
              <Download />
              Exportar para Excel
            </button>
          </div>

          <div className="rounded-md border overflow-auto">
            <table className="w-full">
              <thead>
                <tr className="bg-orange-600">
                  <th className="text-white p-2 text-sm">Prefixo</th>
                  <th className="text-white p-2 text-sm">QTD VZ</th>
                  <th className="text-white p-2 text-sm">Produto</th>
                  <th className="text-white p-2 text-sm">Entrada VTU</th>
                  <th className="text-white p-2 text-sm">Início</th>
                  <th className="text-white p-2 text-sm">Término</th>
                  <th className="text-white p-2 text-sm">Saída VTU</th>
                  <th className="text-white p-2 text-sm">Meta Antes</th>
                  <th className="text-white p-2 text-sm">Real Antes</th>
                  <th className="text-white p-2 text-sm">Meta Durante</th>
                  <th className="text-white p-2 text-sm">Real Durante</th>
                  <th className="text-white p-2 text-sm">Meta Após</th>
                  <th className="text-white p-2 text-sm">Real Após</th>
                  <th className="text-white p-2 text-sm">Ações</th>
                </tr>
              </thead>
              <tbody>
                {registros.map((registro, index) => (
                  <tr 
                    key={registro.id} 
                    className={index % 2 === 0 ? "bg-white" : "bg-gray-50"}
                  >
                    <td className="p-2 font-medium text-sm">{registro.prefixoChegada}</td>
                    <td className="p-2 text-sm">{registro.qtdVZ}</td>
                    <td className="p-2 text-sm">{registro.produto}</td>
                    <td className="p-2 font-semibold text-orange-600 text-sm">{registro.entradaVTU}</td>
                    <td className="p-2 text-sm">{registro.inicioDescarga}</td>
                    <td className="p-2 text-sm">{registro.terminoDescarga}</td>
                    <td className="p-2 font-semibold text-orange-600 text-sm">{registro.saidaVTU}</td>
                    <td className="p-2 bg-yellow-100 text-sm">{registro.metaAntes}</td>
                    <td className="p-2 text-sm">{registro.realAntes}</td>
                    <td className="p-2 bg-yellow-100 text-sm">{registro.metaDurante}</td>
                    <td className="p-2 text-sm">{registro.realDurante}</td>
                    <td className="p-2 bg-yellow-100 text-sm">{registro.metaApos}</td>
                    <td className="p-2 text-sm">{registro.realApos}</td>
                    <td className="p-2">
                      <button
                        onClick={() => handleDelete(registro.id)}
                        className="p-2 hover:bg-gray-200 rounded"
                      >
                        <Trash2 />
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          <div className="text-sm text-gray-500 text-right">
            Total de registros: {registros.length}
          </div>
        </div>
      );
    }

    // Main App
    function App() {
      const [registros, setRegistros] = useState([]);
      const [showTable, setShowTable] = useState(false);

      const handleAddRegistro = (registro) => {
        const novoRegistro = {
          ...registro,
          id: Date.now().toString(),
        };
        setRegistros([...registros, novoRegistro]);
      };

      const handleDeleteRegistro = (id) => {
        setRegistros(registros.filter((r) => r.id !== id));
      };

      return (
        <div className="min-h-screen bg-gray-100 p-4">
          <div className="max-w-[1400px] mx-auto space-y-4">
            <ControlePainelForm onSubmit={handleAddRegistro} />
            
            {registros.length > 0 && (
              <div className="space-y-2">
                <button
                  onClick={() => setShowTable(!showTable)}
                  className="w-full bg-white px-4 py-2 rounded shadow text-left hover:bg-gray-50 flex items-center justify-between"
                >
                  <span className="font-semibold">
                    Registros Salvos ({registros.length})
                  </span>
                  <span className="text-gray-500">
                    {showTable ? "▲ Ocultar" : "▼ Mostrar"}
                  </span>
                </button>
                
                {showTable && (
                  <div className="bg-white rounded shadow p-4">
                    <RegistrosTable 
                      registros={registros} 
                      onDelete={handleDeleteRegistro}
                    />
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      );
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('Service Worker registrado com sucesso:', registration.scope);
          })
          .catch((error) => {
            console.log('Falha ao registrar Service Worker:', error);
          });
      });
    }
  </script>
</body>
</html>
